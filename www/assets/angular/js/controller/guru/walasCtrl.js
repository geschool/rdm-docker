angular.module("RdmApp").controller("walasCtrl",["$cookies","$scope","$rootScope","$stateParams","common","DTOptionsBuilder","DTColumnBuilder","$http","$q","ApiServer",function(a,i,o,n,t,e,r,s,p,k){o.dataharian=[],o.dataketerampilan=[],o.bobot=[],o.kkmdata=[],i.$on("KelasChange",(function(a,i){i.length>0&&o.getwalassiswa()})),o.getwalassiswa=function(){""!==o.walas&&($.blockUI({}),k.get("guru/walas/datasiswa/"+o.walas,(function(a){$.unblockUI({}),o.getSikapsos(),o.getSikapsspi(),o.tingkatwalas=a.tingkat,o.walassiswa=a.data,o.dataabsen=a.dataabsen,o.dataprestasi=a.dataprestasi,angular.forEach(o.walassiswa,(function(a){void 0!==o.dataabsen[a.siswa_id]?a.absen=o.dataabsen[a.siswa_id]:a.absen={},void 0!==o.dataprestasi[a.siswa_id]?a.prestasi=o.dataprestasi[a.siswa_id]:a.prestasi={}}))})))},o.getwalassiswa(),o.dataRapor={},o.getharian=function(){k.get("guru/pengetahuan/harian",(function(a){o.dataharian=[],o.datakomponen=a.komponen,o.datanilai=a.datanilai,o.datapas=a.datapas,o.dataRapor=a.datarapor,console.clear(),angular.forEach(o.datasiswa,(function(a){var n=0,t="",e="",r=100;if(void 0!==o.datanilai[a.siswa_id]){a.nilai=o.datanilai[a.siswa_id],void 0!==o.datapas[a.siswa_id]?a.paspat=parseInt(o.datapas[a.siswa_id]):(a.paspat=0,o.bobot.bobotkelas.paspat>0&&(r=0));var s=0;angular.forEach(o.datakomponen,(function(i){var o;(o=void 0!==a.nilai[i.komponennilai_id]?parseInt(a.nilai[i.komponennilai_id]):0)>n&&(n=o,t=i.komponennilai_materi),o<r&&(r=o,e=i.komponennilai_materi),s+=o})),a.nilaiharian=Math.round(s/o.datakomponen.length,0)}else a.nilai=null,a.nilaiharian=0,a.paspat=0,o.bobot.bobotkelas.harian>0&&(r=0),o.bobot.bobotkelas.paspat>0&&(r=0);if(void 0!==o.dataRapor[a.siswa_id])a.rapor=o.dataRapor[a.siswa_id].rapor_nilai,a.predikat=o.dataRapor[a.siswa_id].rapor_predikat,a.desc=o.dataRapor[a.siswa_id].rapor_deskripsi;else if(a.nilaiharian+a.paspat>0?a.rapor=Math.round((a.nilaiharian*o.bobot.bobotkelas.harian+a.paspat*o.bobot.bobotkelas.paspat)/(o.bobot.bobotkelas.harian+o.bobot.bobotkelas.paspat),2):a.rapor=0,i.FilPredikat=o.kkmdata.kkmgrade.filter((function(i){return parseInt(i.kkmgrade_min)<=a.rapor&&parseInt(i.kkmgrade_max)>=a.rapor})),i.FilPredikat.length>0){a.predikat=i.FilPredikat[0].kkmgrade_kode;var p=parseInt(o.kkmdata.kkmtingkat_nilai),k="";k="A"==a.predikat?"sangat baik":"B"==a.predikat?"baik":"C"==a.predikat?"cukup baik":"kurang baik",a.desc=p<=r&&p<=n?"Memiliki kompetensi dari semua materi yang "+k+" terutama menguasai "+t:p>r&&r>0&&p<=n?"Memiliki kompetensi dari semua materi yang "+k+" terutama menguasai "+t+", dan perlu ditingkatkan dalam "+e:"Perlu pebaikan kompetensi pada seluruh materi",0==a.rapor&&(a.desc="")}else a.predikat="-",a.desc="";o.dataharian.push(a)}))}))},o.getketerampilan=function(){k.get("guru/keterampilan/dataketerampilan",(function(a){o.dataketerampilan=[],o.komponenuk=a.komponenuk,o.datauk=a.datauk,o.komponenpro=a.komponenpro,o.datapro=a.datapro,o.komponenpor=a.komponenpor,o.datapor=a.datapor,angular.forEach(o.datasiswa,(function(a){var n=0,t="",e="",r=100;if(void 0!==o.datauk[a.siswa_id]){a.nilaiuk=o.datauk[a.siswa_id];var s=0;angular.forEach(o.komponenuk,(function(i){var p;p=void 0!==a.nilaiuk[i.komponennilai_id]?parseInt(a.nilaiuk[i.komponennilai_id]):0,o.bobot.bobotkelas.praktek>0&&(p>n&&(n=p,t=i.komponennilai_materi),p<r&&(r=p,e=i.komponennilai_materi)),s+=p})),a.uk=Math.round(s/o.komponenuk.length,0)}else a.nilaiuk=null,a.uk=0,o.bobot.bobotkelas.praktek>0&&(r=0);if(void 0!==o.datapro[a.siswa_id]){a.nilaipro=o.datapro[a.siswa_id];var p=0;angular.forEach(o.komponenpro,(function(i){var s;s=void 0!==a.nilaipro[i.komponennilai_id]?parseInt(a.nilaipro[i.komponennilai_id]):0,o.bobot.bobotkelas.proyek>0&&(s>n&&(n=s,t=i.komponennilai_materi),s<r&&(r=s,e=i.komponennilai_materi)),p+=s})),a.pro=Math.round(p/o.komponenpro.length,0)}else a.nilaipro=null,a.pro=0,o.bobot.bobotkelas.proyek>0&&(r=0);if(void 0!==o.datapor[a.siswa_id]){a.nilaipor=o.datapor[a.siswa_id];var k=0;angular.forEach(o.komponenpor,(function(i){var s;s=void 0!==a.nilaipor[i.komponennilai_id]?parseInt(a.nilaipor[i.komponennilai_id]):0,o.bobot.bobotkelas.porto>0&&(s>n&&(n=s,t=i.komponennilai_materi),s<r&&(r=s,e=i.komponennilai_materi)),k+=s})),a.por=Math.round(k/o.komponenpor.length,0)}else a.nilaipor=null,a.por=0,o.bobot.bobotkelas.porto>0&&(r=0);if(a.uk+a.pro+a.por>0?a.rapork=Math.round((a.uk*o.bobot.bobotkelas.praktek+a.pro*o.bobot.bobotkelas.proyek+a.por*o.bobot.bobotkelas.porto)/(o.bobot.bobotkelas.praktek+o.bobot.bobotkelas.proyek+o.bobot.bobotkelas.porto),2):a.rapork=0,i.FilPredikat=o.kkmdata.kkmgrade.filter((function(i){return parseInt(i.kkmgrade_min)<=a.rapork&&parseInt(i.kkmgrade_max)>=a.rapork})),i.FilPredikat.length>0){a.predikatk=i.FilPredikat[0].kkmgrade_kode;var l=parseInt(o.kkmdata.kkmtingkat_nilai),d="";d="A"==a.predikatk?"sangat baik":"B"==a.predikatk?"baik":"C"==a.predikatk?"cukup baik":"kurang baik",a.desck=l<=r&&l<=n?"Memiliki kompetensi dari semua materi yang "+d+" terutama menguasai "+t:l>r&&r>0&&l<=n?"Memiliki kompetensi dari semua materi yang "+d+" terutama menguasai "+t+", dan perlu ditingkatkan dalam "+e:"Perlu pebaikan kompetensi pada seluruh materi",0==a.rapork&&(a.desck="")}else a.predikatk="-";o.dataketerampilan.push(a)}))}))},o.getSikapsos=function(){$.blockUI({}),k.get("guru/sikap/datasikapsos/"+o.walas,(function(a){$.unblockUI({}),o.datasikapsos=[],o.datakomponensikapsos=a.komponen,o.datanilaisikapsos=a.datanilai,o.jenisnilaisos=a.jenisnilai,angular.forEach(o.walassiswa,(function(a){o.datasikapsos.push(a)})),o.jnilaisos=0,angular.forEach(o.jenisnilaisos,(function(a){a.cnilai>0&&o.jnilaisos++}))}))},o.getSikapsspi=function(){$.blockUI({}),k.get("guru/sikap/datasikapspi/"+o.walas,(function(a){$.unblockUI({}),o.datasikapspi=[],o.datakomponensikapspi=a.komponen,o.datanilaisikapspi=a.datanilai,o.jenisnilaispi=a.jenisnilai,angular.forEach(o.walassiswa,(function(a){o.datasikapspi.push(a)})),o.jnilaispi=0,angular.forEach(o.jenisnilaispi,(function(a){a.cnilai>0&&o.jnilaispi++}))}))}}]);