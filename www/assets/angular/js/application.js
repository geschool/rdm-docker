var d=new Date,versionApp="?"+RDM_version,TimeZoneDiv=TzDifference-d.getTimezoneOffset(),RdmApp=angular.module("RdmApp",["ngCookies","ui.router","ui.bootstrap","oc.lazyLoad","ngSanitize","datatables","angularFileUpload","infinite-scroll","ADM-dateTimePicker","datatables.buttons"]);RdmApp.constant("ConstantAlias",{}),RdmApp.config(["$controllerProvider",function(e){}]),RdmApp.controller("HeaderController",["$scope",function(e){e.$on("$includeContentLoaded",(function(){}))}]),RdmApp.config(["$ocLazyLoadProvider",function(e){e.config({})}]),RdmApp.run(["$rootScope","$location","$state","$http","$window","$cookies",function(e,t,a,n,o,r){e.$state=a,e.userData=r.get("rdmData")||{},e.$on("$stateChangeStart",(function(){jQuery.blockUI({})})),e.$on("$viewContentLoaded",(function(){try{jQuery.unblockUI({})}catch(e){}})),e.$on("$stateChangeSuccess",(function(){jQuery.blockUI({}),setTimeout((function(){}),500)})),a.defaultErrorHandler((function(e){window.myAppErrorLog.push(e)})),e.$on("$stateChangeError",(function(){jQuery.blockUI({}),Swal.fire({type:"error",title:"Error",showConfirmButton:!0,html:"Tidak dapat memuat halaman yang anda minta."})})),e.$on("$stateNotFound",(function(){jQuery.unblockUI({})})),e.$on("$locationChangeStart",(function(t,a,n){setTimeout((function(){$(".datepicker").hide()}),500);var o=r.get("rdmData")||"",i=r.get("_revision")||"";""==o?window.location.reload():(i!==RDM_version&&(clearCacheWB(),Swal.fire({type:"warning",title:"Update",showConfirmButton:!1,html:"Terdapat pembaharuan aplikasi, aplikasi akan dimuat ulang",timer:1500}).then((e=>{e.dismiss===Swal.DismissReason.timer&&window.location.reload()}))),e.userData=JSON.parse(o),e.userData.nama=e.userData.nama.replace("+"," "))}))}]),RdmApp.controller("SidebarController",["$state","$scope",function(e,t){setTimeout((function(){handleSidebarMenuActiveLink("match",null,e)}),1e3),t.$on("$includeContentLoaded",(function(){Array.from(document.querySelectorAll(".c-sidebar")).forEach((function(e){Sidebar._sidebarInterface(e)}))}))}]),RdmApp.controller("rdmController",["$rootScope","$state","$scope","$cookies","ApiServer",function(e,t,a,n,o){e.logResize=function(){},e.cekLogin=function(){""==(n.get("rdmData")||"")&&window.location.reload()},e.customepdf=function(e,t,a){e.content.splice(0,1);var n=new Date,o=n.getDate()+"-"+(n.getMonth()+1)+"-"+n.getFullYear();e.pageMargins=[20,60,20,40],e.defaultStyle.fontSize=12,e.styles.tableHeader.fontSize=14,e.header=function(){return{columns:[{alignment:"left",italics:!0,text:t,fontSize:14,margin:[10,0]},{alignment:"right",fontSize:14,text:a}],margin:20}},e.footer=function(e,t){return{columns:[{alignment:"left",text:["Created on: ",{text:o.toString()}]},{alignment:"right",text:["page ",{text:e.toString()}," of ",{text:t.toString()}]}],margin:20}};var r={hLineWidth:function(e){return.5},vLineWidth:function(e){return.5},hLineColor:function(e){return"#aaa"},vLineColor:function(e){return"#aaa"},paddingLeft:function(e){return 8},paddingRight:function(e){return 4}};return e.content[0].layout=r,e};var r=0,i=setInterval((function(){!function(){r>100?r>=107&&(clearInterval(i),$(".pre-loader").hide()):(e=r,document.getElementById("bar1").style.width=e+"%",document.getElementById("percent1").innerHTML=e+"%");var e;r++}()}),10)}]),RdmApp.controller("guruController",["$rootScope","$state","$scope","ApiServer",function(e,t,a,n){e.dataTimeline=[],e.selectKelas="",e.posts=[],e.datasiswa=[],e.walas="",e.dataeksekutif={},e.datakelas=[],e.profile={},e.aktif={},e.aktif.semester_id="",e.dochangeSemester=function(){console.log(e.aktif.semester_id),$(".semester-modal").modal("hide"),Swal.fire({title:"Ubah Semester",text:"Apakah anda yakin ingin mengubah semester?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, Ubah!"}).then((t=>{t.value&&($.blockUI({}),n.post("guru/ubahsemester",{semesteraktif:e.aktif.semester_id},(function(e){$.unblockUI({}),e.success?(Swal.fire({type:"success",title:"Berhasil",showConfirmButton:!1,html:"Data Semester berhasil diubah",timer:1e3}),location.reload()):Swal.fire({type:"error",title:"Gagal",showConfirmButton:!0,html:e.message}).then((e=>{e.value&&($(".semester-modal").modal("show"),$(".modal-dialog").draggable({handle:".modal-header"}))}))})))}))},e.ubahSemesterAktif=function(){$(".semester-modal").modal("show"),$(".modal-dialog").draggable({handle:".modal-header"}),console.log("Fire change semester")},e.getprofile=function(){n.get("guru/profile",(function(t){e.profile=t.data}))},e.getprofile(),e.getdatakelas=function(){n.get("guru/getkelas",(function(n){e.datakelas=n.data,e.walas=n.walas,e.datawalas=n.datawalas,e.extra=n.extra,e.dataextra=n.dataextra,a.$broadcast("KelasChange",e.datakelas),setTimeout((function(){handleSidebarMenuActiveLink("match",null,t)}),1e3)}))},e.getdatakelas(),e.getsemester=function(){n.get("guru/datasemester",(function(t){e.datasemester=t.data}))},e.getsemester()}]),RdmApp.controller("proktor",["$rootScope","$state","$scope","ApiServer",function(e,t,a,n){e.datasiswa={},e.tempdatasiswa={},e.dataguru={},e.dataeksekutif={},e.datakelas={},e.MapelInduk={},e.datarombel={},e.datasemester={},e.dataekstrakurikuler={},e.loaddatasiswa=!0,e.aktif={},e.aktif.semester_id="",e.dochangeSemester=function(){console.log(e.aktif.semester_id),$(".semester-modal").modal("hide"),Swal.fire({title:"Ubah Semester",text:"Apakah anda yakin ingin mengubah semester?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, Ubah!"}).then((t=>{t.value&&($.blockUI({}),n.post("proktor/ubahsemester",{semesteraktif:e.aktif.semester_id},(function(e){$.unblockUI({}),e.success?(Swal.fire({type:"success",title:"Berhasil",showConfirmButton:!1,html:"Data Semester berhasil diubah",timer:1e3}),location.reload()):Swal.fire({type:"error",title:"Gagal",showConfirmButton:!0,html:e.message}).then((e=>{e.value&&($(".semester-modal").modal("show"),$(".modal-dialog").draggable({handle:".modal-header"}))}))})))}))},e.ubahSemesterAktif=function(){$(".semester-modal").modal("show"),$(".modal-dialog").draggable({handle:".modal-header"}),console.log("Fire change semester")},e.getdataguru=function(){n.get("proktor/guru/data",(function(t){e.dataguru=t.data}))},e.rendering=!1,e.chekupdate=function(){n.get("proktor/chekupdate",(function(t){0==t.success&&Swal.fire({title:"Update RDM",text:"Tersedia update aplikasi!",type:"info",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, Update sekarang!"}).then((t=>{t.value&&e.doupdate("download")}))}))},e.updatedone=function(){$.blockUI({message:"<h2>Harap bersabar!!<br>Sedang proses update!</h2>",baseZ:9999}),n.get("login/updatedone",(function(e){$.unblockUI({}),e.success?Swal.fire({type:"success",title:"Update Berhasil",showConfirmButton:!0,html:"Aplikasi RDM sukses di update ke versi terbaru."}).then((e=>{e.value&&window.location.reload()})):Swal.fire({type:"error",title:"Gagal",showConfirmButton:!0,html:"Gagal menyimpan update RDM."})}))},e.doupdate=function(t){console.log("Update Confirm"+t),"download"==t?$.blockUI({message:"<h2>Harap bersabar!!<br>Sedang mendownload Update!</h2>",baseZ:9999}):$.blockUI({message:"<h2>Harap bersabar!!<br>Sedang proses update!</h2>",baseZ:9999}),n.get("newupdate.php?"+t,(function(a){$.unblockUI({}),console.log(a.success),a.success?"download"==t?e.doupdate("extract"):"extract"==t&&e.updatedone():void 0!==a.message?Swal.fire({type:"error",title:"Gagal",showConfirmButton:!0,html:a.message}):"download"==t?Swal.fire({type:"error",title:"Gagal",showConfirmButton:!0,html:"Gagal mengunduh file update."}):"extract"==t&&Swal.fire({type:"error",title:"Gagal",showConfirmButton:!0,html:"Gagal mengextract file update."})}))},e.chekupdate(),e.getdatasiswa=function(t){$.blockUI({}),n.post("proktor/siswa/data",t,(function(t){$.unblockUI({}),e.datasiswa=t.data}))},e.getdataajar=function(t){$.blockUI({}),n.post("proktor/ajar/data",t,(function(t){$.unblockUI({}),e.dataajar=t.data}))},e.datasiswa={},e.pimpinan={},e.getprofile=function(){n.get("proktor/profile",(function(t){e.profile=t.data,e.pimpinan=t.pimpinan}))},e.getprofile(),e.aturcetak={},e.getdataguru(),e.getpengaturan=function(){n.get("proktor/pengaturan/data",(function(t){e.tahunajaran=t.tahunajaran,e.datasemester=t.semester,e.aturcetak=t.aturcetak,e.penilaian.system=t.sistem_penilaian}))},e.penilaian={},e.getpengaturan(),e.getsemester=function(){n.get("proktor/semester/data",(function(t){e.datasemester=t.data,e.aturcetak=t.aturcetak}))},e.gettahunajaran=function(){n.get("proktor/tahunajaran/data",(function(t){e.tahunajaran=t.data}))},e.dataKelas={},e.getdatakelas=function(){n.get("proktor/kelas/data",(function(t){e.dataKelas=t.data,e.getdatatingkat()}))},e.getdatakelas(),e.getdataMapel=function(){n.get("proktor/mapel/data",(function(t){e.dataMapel=t.data,e.MapelInduk=t.induk}))},e.getdataMapel(),e.getdatatingkat=function(){n.get("proktor/kelas/datatingkat",(function(t){e.tingkat=t.tingkat,e.jurusan=t.jurusan,e.kelas=t.kelas}))},e.getdataekstra=function(){e.rendering=!1,n.get("proktor/ekstrakurikuler/data",(function(t){$.unblockUI({}),e.dataekstrakurikuler=t.data,setTimeout((function(){e.rendering=!0}))}))},e.reloaddataProktor=function(){e.getdataguru(),e.getprofile(),e.getsemester(),e.gettahunajaran(),e.getdataMapel(),e.getdatakelas()}}]);